{% extends "base.html" %}

{% block title %}Goodbye - Sales Agent System{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card shadow-sm border-0">
            <div class="card-body text-center p-5">
                <div class="mb-4">
                    <i class="fas fa-hand-wave fa-4x text-primary"></i>
                </div>
                
                <h2 class="h3 fw-bold text-primary mb-3">
                    Thank You!
                </h2>
                
                <div class="alert alert-success border-0 mb-4">
                    <p class="mb-0">{{ message }}</p>
                </div>
                
                <p class="text-muted mb-4">
                    We appreciate your time and hope you found our service helpful. 
                    Feel free to return anytime if you need assistance with product recommendations.
                </p>
                
                <div class="row g-3">
                    <div class="col-6">
                        <a href="{{ redirect_url or url_for('home') }}" class="btn btn-primary w-100">
                            <i class="fas fa-home me-2"></i>
                            Start New Chat
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="/api/analytics/leads" target="_blank" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-chart-bar me-2"></i>
                            View Analytics
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Feedback Section -->
        <div class="card mt-4 border-0 bg-light">
            <div class="card-body text-center">
                <h6 class="fw-bold mb-3">Help Us Improve</h6>
                <p class="text-muted small mb-3">
                    Your feedback helps us enhance our AI sales assistant
                </p>
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-sm btn-outline-success" onclick="submitFeedback('positive')">
                        <i class="fas fa-thumbs-up me-1"></i>
                        Helpful
                    </button>
                    <button class="btn btn-sm btn-outline-warning" onclick="submitFeedback('neutral')">
                        <i class="fas fa-meh me-1"></i>
                        Okay
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="submitFeedback('negative')">
                        <i class="fas fa-thumbs-down me-1"></i>
                        Needs Work
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Auto-redirect notice -->
<div class="row justify-content-center mt-4">
    <div class="col-lg-6">
        <div class="text-center">
            <small class="text-muted">
                <i class="fas fa-clock me-1"></i>
                You will be redirected to the home page in <span id="countdown">10</span> seconds
            </small>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto-redirect countdown
let countdown = 10;
const countdownElement = document.getElementById('countdown');

function updateCountdown() {
    countdown--;
    countdownElement.textContent = countdown;
    
    if (countdown <= 0) {
        window.location.href = '{{ redirect_url or url_for("home") }}';
    }
}

// Start countdown
const countdownInterval = setInterval(updateCountdown, 1000);

// Feedback submission
function submitFeedback(type) {
    // Simple feedback submission
    fetch('/api/feedback', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            feedback_type: type,
            page: 'exit',
            timestamp: new Date().toISOString()
        })
    })
    .then(response => response.json())
    .then(data => {
        // Show thank you message
        const feedbackSection = document.querySelector('.card.bg-light .card-body');
        feedbackSection.innerHTML = `
            <div class="text-success">
                <i class="fas fa-check-circle fa-2x mb-2"></i>
                <h6 class="fw-bold">Thank You!</h6>
                <p class="text-muted small mb-0">Your feedback has been recorded.</p>
            </div>
        `;
    })
    .catch(error => {
        console.log('Feedback submission failed:', error);
        // Still show thank you message for better UX
        const feedbackSection = document.querySelector('.card.bg-light .card-body');
        feedbackSection.innerHTML = `
            <div class="text-success">
                <i class="fas fa-check-circle fa-2x mb-2"></i>
                <h6 class="fw-bold">Thank You!</h6>
                <p class="text-muted small mb-0">Your feedback has been noted.</p>
            </div>
        `;
    });
}

// Clear countdown if user clicks on a link
document.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
        clearInterval(countdownInterval);
    });
});

// Pause countdown on hover
document.querySelector('.card').addEventListener('mouseenter', () => {
    clearInterval(countdownInterval);
});

// Resume countdown when mouse leaves (optional)
document.querySelector('.card').addEventListener('mouseleave', () => {
    // Don't resume countdown to give user control
});
</script>
{% endblock %} 